{"version":3,"sources":["../../../../../../../src/server/modules/machine-news/aggregates/news/hooks/checkFollowNews.hook.ts"],"names":["checkFollowNews","context","params","authUser","id","checkFollowPromises","followNewsRepository","findOne","user","news","result","_id","followUsersRepository","followee","owner","shop","push","followShopRepository","Promise","all","followNews","followUser","followShop","JSONResult","JSON","parse","stringify","isFollowing","Boolean","undefined"],"mappings":";;;;;;;;;AACA;;AACA;;AACA;;;;;;;;;;;;;;;;;;;;AAEO,IAAMA,eAAe;AAAA;AAAA;AAAA;AAAA;AAAA,4BAAG,iBAAOC,OAAP;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA,kBACzBA,OAAO,CAACC,MAAR,CAAeC,QAAf,IAA2BF,OAAO,CAACC,MAAR,CAAeC,QAAf,CAAwBC,EAD1B;AAAA;AAAA;AAAA;;AAErBC,YAAAA,mBAFqB,GAEQ,CACjCC,iCAAqBC,OAArB,CAA6B;AAC3BC,cAAAA,IAAI,EAAEP,OAAO,CAACC,MAAR,CAAeC,QAAf,CAAwBC,EADH;AAE3BK,cAAAA,IAAI,EAAER,OAAO,CAACS,MAAR,CAAeC;AAFM,aAA7B,CADiC,EAKjCC,mCAAsBL,OAAtB,CAA8B;AAC5BC,cAAAA,IAAI,EAAEP,OAAO,CAACC,MAAR,CAAeC,QAAf,CAAwBC,EADF;AAE5BS,cAAAA,QAAQ,EAAEZ,OAAO,CAACS,MAAR,CAAeI,KAAf,CAAqBH;AAFH,aAA9B,CALiC,CAFR;;AAY3B,gBAAIV,OAAO,CAACS,MAAR,CAAeK,IAAf,IAAuBd,OAAO,CAACS,MAAR,CAAeK,IAAf,CAAoBJ,GAA/C,EAAoD;AAClDN,cAAAA,mBAAmB,CAACW,IAApB,CAAyBC,kCAAqBV,OAArB,CAA6B;AACpDC,gBAAAA,IAAI,EAAEP,OAAO,CAACC,MAAR,CAAeC,QAAf,CAAwBC,EADsB;AAEpDW,gBAAAA,IAAI,EAAEd,OAAO,CAACS,MAAR,CAAeK,IAAf,CAAoBJ;AAF0B,eAA7B,CAAzB;AAID;;AAjB0B;AAAA,mBAkBwBO,OAAO,CAACC,GAAR,CAAYd,mBAAZ,CAlBxB;;AAAA;AAAA;AAAA;AAkBpBe,YAAAA,UAlBoB;AAkBRC,YAAAA,UAlBQ;AAkBIC,YAAAA,UAlBJ;AAoBrBC,YAAAA,UApBqB,GAoBRC,IAAI,CAACC,KAAL,CAAWD,IAAI,CAACE,SAAL,CAAezB,OAAO,CAACS,MAAvB,CAAX,CApBQ;AAqB3BT,YAAAA,OAAO,CAACS,MAAR,qBACKa,UADL;AAEET,cAAAA,KAAK,oBACAS,UAAU,CAACT,KADX;AAEHa,gBAAAA,WAAW,EAAEC,OAAO,CAACP,UAAD;AAFjB,gBAFP;AAMEN,cAAAA,IAAI,EAAEQ,UAAU,CAACR,IAAX,IAAmBd,OAAO,CAACS,MAAR,CAAeK,IAAf,CAAoBJ,GAAvC,qBACDY,UAAU,CAACR,IADV;AAEJY,gBAAAA,WAAW,EAAEC,OAAO,CAACN,UAAD;AAFhB,mBAGFO,SATN;AAUEF,cAAAA,WAAW,EAAEC,OAAO,CAACR,UAAD;AAVtB;;AArB2B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAH;;AAAA,kBAAfpB,eAAe;AAAA;AAAA;AAAA,GAArB","sourcesContent":["import { HookContext } from '@feathersjs/feathers';\nimport { followNewsRepository } from '../../follows/follow-news.repository';\nimport { followUsersRepository } from '../../follows/follow-users.repository';\nimport { followShopRepository } from '../../follows/follow-shops.repository';\n\nexport const checkFollowNews = async (context: HookContext) => {\n  if (context.params.authUser && context.params.authUser.id) {\n    const checkFollowPromises: any[] = [\n      followNewsRepository.findOne({\n        user: context.params.authUser.id,\n        news: context.result._id,\n      }),\n      followUsersRepository.findOne({\n        user: context.params.authUser.id,\n        followee: context.result.owner._id,\n      }),\n    ];\n    if (context.result.shop && context.result.shop._id) {\n      checkFollowPromises.push(followShopRepository.findOne({\n        user: context.params.authUser.id,\n        shop: context.result.shop._id,\n      }));\n    }\n    const [followNews, followUser, followShop] = await Promise.all(checkFollowPromises);\n\n    const JSONResult = JSON.parse(JSON.stringify(context.result));\n    context.result = {\n      ...JSONResult,\n      owner: {\n        ...JSONResult.owner,\n        isFollowing: Boolean(followUser),\n      },\n      shop: JSONResult.shop && context.result.shop._id ? {\n        ...JSONResult.shop,\n        isFollowing: Boolean(followShop),\n      } : undefined,\n      isFollowing: Boolean(followNews),\n    };\n  }\n};\n"],"file":"checkFollowNews.hook.js"}