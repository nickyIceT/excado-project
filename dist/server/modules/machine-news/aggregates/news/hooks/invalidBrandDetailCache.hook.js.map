{"version":3,"sources":["../../../../../../../src/server/modules/machine-news/aggregates/news/hooks/invalidBrandDetailCache.hook.ts"],"names":["invalidBrandDetailCache","context","NewsModel","findById","result","id","populate","exec","newsInfo","brand","_id","key","slug","apiCache","del","error","logger"],"mappings":";;;;;;;;;AACA;;AACA;;;;;;;;AAEO,IAAMA,uBAAuB;AAAA;AAAA;AAAA;AAAA;AAAA,4BAAG,iBAAOC,OAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBACdC,gBAAUC,QAAV,CAAmBF,OAAO,CAACG,MAAR,CAAeC,EAAf,IAAqBJ,OAAO,CAACI,EAAhD,EAAoDC,QAApD,CAA6D,OAA7D,EAAsEC,IAAtE,EADc;;AAAA;AAC/BC,YAAAA,QAD+B;;AAErC,gBAAIA,QAAQ,IAAIA,QAAQ,CAACC,KAArB,IAA8BD,QAAQ,CAACC,KAAT,CAAeC,GAAjD,EAAsD;AAC9CC,cAAAA,GAD8C,mDACCH,QAAQ,CAACC,KAAT,CAAeG,IADhB;;AAEpDC,6BAASC,GAAT,CAAaH,GAAb,EAAkB,UAACI,KAAD,EAAW;AAC3BC,6BAAOD,KAAP,CAAaA,KAAb;AACD,eAFD;AAGD;;AAPoC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAH;;AAAA,kBAAvBf,uBAAuB;AAAA;AAAA;AAAA,GAA7B","sourcesContent":["import { HookContext } from '@feathersjs/feathers';\nimport { apiCache, logger } from '@app/core';\nimport { NewsModel } from '../news.repository';\n\nexport const invalidBrandDetailCache = async (context: HookContext) => {\n  const newsInfo = await NewsModel.findById(context.result.id || context.id).populate('brand').exec() as any;\n  if (newsInfo && newsInfo.brand && newsInfo.brand._id) {\n    const key = `/api/brands/customs/find-brand-detail/${newsInfo.brand.slug}`;\n    apiCache.del(key, (error) => {\n      logger.error(error);\n    });\n  }\n};\n"],"file":"invalidBrandDetailCache.hook.js"}