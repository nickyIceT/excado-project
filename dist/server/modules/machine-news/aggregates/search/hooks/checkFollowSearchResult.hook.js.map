{"version":3,"sources":["../../../../../../../src/server/modules/machine-news/aggregates/search/hooks/checkFollowSearchResult.hook.ts"],"names":["checkFollowSearchResult","context","params","authUser","id","checkFollowPromises","result","data","filter","ite","forEach","item","push","followNewsRepository","findOne","user","news","_id","Promise","all","followResult","JSONResult","JSON","parse","stringify","i","length","followBy","isFollowing","Boolean"],"mappings":";;;;;;;;;AACA;;;;;;;;;;;;AAEO,IAAMA,uBAAuB;AAAA;AAAA;AAAA;AAAA;AAAA,4BAAG,iBAAOC,OAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACjCA,OAAO,CAACC,MAAR,CAAeC,QAAf,IAA2BF,OAAO,CAACC,MAAR,CAAeC,QAAf,CAAwBC,EADlB;AAAA;AAAA;AAAA;;AAE7BC,YAAAA,mBAF6B,GAEF,EAFE;AAGnCJ,YAAAA,OAAO,CAACK,MAAR,CAAeC,IAAf,CAAoBC,MAApB,CAA2B,UAACC,GAAD;AAAA,qBAAcA,GAAd;AAAA,aAA3B,EAA8CC,OAA9C,CAAsD,UAACC,IAAD,EAAe;AACnEN,cAAAA,mBAAmB,CAACO,IAApB,CAAyBC,iCAAqBC,OAArB,CAA6B;AACpDC,gBAAAA,IAAI,EAAEd,OAAO,CAACC,MAAR,CAAeC,QAAf,CAAwBC,EADsB;AAEpDY,gBAAAA,IAAI,EAAEL,IAAI,CAACM;AAFyC,eAA7B,CAAzB;AAID,aALD;AAHmC;AAAA,mBASRC,OAAO,CAACC,GAAR,CAAYd,mBAAZ,CATQ;;AAAA;AAS7Be,YAAAA,YAT6B;AAW7BC,YAAAA,UAX6B,GAWhBC,IAAI,CAACC,KAAL,CAAWD,IAAI,CAACE,SAAL,CAAevB,OAAO,CAACK,MAAvB,CAAX,CAXgB;AAY7BC,YAAAA,IAZ6B,GAYtB,EAZsB;;AAanC,iBAASkB,CAAT,GAAa,CAAb,EAAgBA,CAAC,GAAGL,YAAY,CAACM,MAAjC,EAAyCD,CAAC,IAAI,CAA9C,EAAiD;AAC/ClB,cAAAA,IAAI,CAACK,IAAL,mBACKS,UAAU,CAACd,IAAX,CAAgBkB,CAAhB,CADL;AAEEE,gBAAAA,QAAQ,EAAE,EAFZ;AAGEC,gBAAAA,WAAW,EAAEC,OAAO,CAACT,YAAY,CAACK,CAAD,CAAb;AAHtB;AAKD;;AACDxB,YAAAA,OAAO,CAACK,MAAR,qBACKe,UADL;AAEEd,cAAAA,IAAI,EAAJA;AAFF;;AApBmC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAH;;AAAA,kBAAvBP,uBAAuB;AAAA;AAAA;AAAA,GAA7B","sourcesContent":["import { HookContext } from '@feathersjs/feathers';\nimport { followNewsRepository } from '../../follows/follow-news.repository';\n\nexport const checkFollowSearchResult = async (context: HookContext) => {\n  if (context.params.authUser && context.params.authUser.id) {\n    const checkFollowPromises: any = [];\n    context.result.data.filter((ite: any) => ite).forEach((item: any) => {\n      checkFollowPromises.push(followNewsRepository.findOne({\n        user: context.params.authUser.id,\n        news: item._id,\n      }));\n    });\n    const followResult = await Promise.all(checkFollowPromises);\n\n    const JSONResult = JSON.parse(JSON.stringify(context.result));\n    const data = [];\n    for (let i = 0; i < followResult.length; i += 1) {\n      data.push({\n        ...JSONResult.data[i],\n        followBy: [],\n        isFollowing: Boolean(followResult[i]),\n      });\n    }\n    context.result = {\n      ...JSONResult,\n      data,\n    };\n  }\n};\n"],"file":"checkFollowSearchResult.hook.js"}