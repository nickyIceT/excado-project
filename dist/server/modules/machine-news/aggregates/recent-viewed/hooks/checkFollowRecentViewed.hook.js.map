{"version":3,"sources":["../../../../../../../src/server/modules/machine-news/aggregates/recent-viewed/hooks/checkFollowRecentViewed.hook.ts"],"names":["checkFollowRecentViewed","context","params","authUser","id","checkFollowPromises","result","data","forEach","item","push","followNewsRepository","findOne","user","news","_id","Promise","all","followResult","JSONResult","JSON","parse","stringify","i","length","followBy","isFollowing","Boolean"],"mappings":";;;;;;;;;AACA;;;;;;;;;;;;AAEO,IAAMA,uBAAuB;AAAA;AAAA;AAAA;AAAA;AAAA,4BAAG,iBAAOC,OAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACjCA,OAAO,CAACC,MAAR,CAAeC,QAAf,IAA2BF,OAAO,CAACC,MAAR,CAAeC,QAAf,CAAwBC,EADlB;AAAA;AAAA;AAAA;;AAE7BC,YAAAA,mBAF6B,GAEF,EAFE;AAGnCJ,YAAAA,OAAO,CAACK,MAAR,CAAeC,IAAf,CAAoBC,OAApB,CAA4B,UAACC,IAAD,EAAe;AACzCJ,cAAAA,mBAAmB,CAACK,IAApB,CAAyBC,iCAAqBC,OAArB,CAA6B;AACpDC,gBAAAA,IAAI,EAAEZ,OAAO,CAACC,MAAR,CAAeC,QAAf,CAAwBC,EADsB;AAEpDU,gBAAAA,IAAI,EAAEL,IAAI,CAACK,IAAL,CAAUC;AAFoC,eAA7B,CAAzB;AAID,aALD;AAHmC;AAAA,mBASRC,OAAO,CAACC,GAAR,CAAYZ,mBAAZ,CATQ;;AAAA;AAS7Ba,YAAAA,YAT6B;AAW7BC,YAAAA,UAX6B,GAWhBC,IAAI,CAACC,KAAL,CAAWD,IAAI,CAACE,SAAL,CAAerB,OAAO,CAACK,MAAvB,CAAX,CAXgB;AAY7BC,YAAAA,IAZ6B,GAYtB,EAZsB;;AAanC,iBAASgB,CAAT,GAAa,CAAb,EAAgBA,CAAC,GAAGL,YAAY,CAACM,MAAjC,EAAyCD,CAAC,IAAI,CAA9C,EAAiD;AAC/ChB,cAAAA,IAAI,CAACG,IAAL,mBACKS,UAAU,CAACZ,IAAX,CAAgBgB,CAAhB,CADL;AAEET,gBAAAA,IAAI,oBACCK,UAAU,CAACZ,IAAX,CAAgBgB,CAAhB,EAAmBT,IADpB;AAEFW,kBAAAA,QAAQ,EAAE,EAFR;AAGFC,kBAAAA,WAAW,EAAEC,OAAO,CAACT,YAAY,CAACK,CAAD,CAAb;AAHlB;AAFN;AAQD;;AACDtB,YAAAA,OAAO,CAACK,MAAR,qBACKa,UADL;AAEEZ,cAAAA,IAAI,EAAJA;AAFF;;AAvBmC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAH;;AAAA,kBAAvBP,uBAAuB;AAAA;AAAA;AAAA,GAA7B","sourcesContent":["import { HookContext } from '@feathersjs/feathers';\nimport { followNewsRepository } from '../../follows/follow-news.repository';\n\nexport const checkFollowRecentViewed = async (context: HookContext) => {\n  if (context.params.authUser && context.params.authUser.id) {\n    const checkFollowPromises: any = [];\n    context.result.data.forEach((item: any) => {\n      checkFollowPromises.push(followNewsRepository.findOne({\n        user: context.params.authUser.id,\n        news: item.news._id,\n      }));\n    });\n    const followResult = await Promise.all(checkFollowPromises);\n\n    const JSONResult = JSON.parse(JSON.stringify(context.result));\n    const data = [];\n    for (let i = 0; i < followResult.length; i += 1) {\n      data.push({\n        ...JSONResult.data[i],\n        news: {\n          ...JSONResult.data[i].news,\n          followBy: [],\n          isFollowing: Boolean(followResult[i]),\n        },\n      });\n    }\n    context.result = {\n      ...JSONResult,\n      data,\n    };\n  }\n};\n"],"file":"checkFollowRecentViewed.hook.js"}