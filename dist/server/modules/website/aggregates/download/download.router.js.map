{"version":3,"sources":["../../../../../../src/server/modules/website/aggregates/download/download.router.ts"],"names":["downloadsRouter","express","Router","get","req","res","idToken","headers","authorization","cookies","token","admin","auth","verifyIdToken","decodedIdToken","roles","indexOf","download","path","join","__dirname","NotAuthorizedError","status","send","message"],"mappings":";;;;;;;;;AAAA;;AACA;;AACA;;AACA;;AACA;;;;;;;;;;AAEA,IAAMA,eAAe,GAAGC,OAAO,CAACC,MAAR,EAAxB;;AAEAF,eAAe,CAACG,GAAhB,CAAoB,iBAApB;AAAA;AAAA;AAAA;AAAA;AAAA,4BAAuC,iBAAOC,GAAP,EAAiBC,GAAjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAE7BC,YAAAA,OAF6B,GAEnB,sBAAQF,GAAG,CAACG,OAAJ,CAAYC,aAAZ,IAA6BJ,GAAG,CAACK,OAAJ,CAAYC,KAAjD,EAAwD,SAAxD,EAAmE,EAAnE,CAFmB;AAAA;AAAA,mBAGNC,uBAAMC,IAAN,GAAaC,aAAb,CAA2BP,OAA3B,CAHM;;AAAA;AAG7BQ,YAAAA,cAH6B;;AAAA,kBAI/BA,cAAc,CAACC,KAAf,CAAqBC,OAArB,CAA6B,0BAA7B,IAA2D,CAAC,CAJ7B;AAAA;AAAA;AAAA;;AAKjCX,YAAAA,GAAG,CAACY,QAAJ,CAAaC,IAAI,CAACC,IAAL,CAAUC,SAAV,gDAAb;AALiC;AAAA;;AAAA;AAAA,kBAO3B,IAAIC,wBAAJ,EAP2B;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAUnChB,YAAAA,GAAG,CAACiB,MAAJ,CAAW,YAAMA,MAAN,IAAgB,GAA3B,EAAgCC,IAAhC,CAAqC,YAAMC,OAAN,IAAiB,uBAAtD;;AAVmC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAvC;;AAAA;AAAA;AAAA;AAAA","sourcesContent":["import * as express from 'express';\nimport replace from 'lodash/replace';\nimport admin from 'firebase-admin';\nimport * as path from 'path';\nimport { NotAuthorizedError } from '@app/core';\n\nconst downloadsRouter = express.Router();\n\ndownloadsRouter.get('/excel-template', async (req: any, res) => {\n  try {\n    const idToken = replace(req.headers.authorization || req.cookies.token, 'Bearer ', '');\n    const decodedIdToken = await admin.auth().verifyIdToken(idToken);\n    if (decodedIdToken.roles.indexOf('5c7f747708898183ac62f2af') > -1) {\n      res.download(path.join(__dirname, `../../../../../../import-news-template.xlsx`));\n    } else {\n      throw new NotAuthorizedError();\n    }\n  } catch (error) {\n    res.status(error.status || 500).send(error.message || 'Internal Server Error');\n  }\n});\n\nexport {\n  downloadsRouter,\n};\n"],"file":"download.router.js"}