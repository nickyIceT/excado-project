{"version":3,"sources":["../../../../src/server/core/storages/local.storage.ts"],"names":["saveFileStream","stream","filePath","saveLocation","config","storage","folder","indexOf","fs","ensureDir","path","dirname","Promise","resolve","reject","fileStream","createWriteStream","pipe","on","error"],"mappings":";;;;;;;;;AAAA;;AACA;;AACA;;;;;;;;AAEO,IAAMA,cAAc;AAAA;AAAA;AAAA;AAAA;AAAA,4BAAG,iBAAOC,MAAP,EAAsCC,QAAtC;AAAA;AAAA;AAAA;AAAA;AAAA;AACtBC,YAAAA,YADsB,aACJC,eAAOC,OAAP,CAAeC,MADX,SACoBJ,QAAQ,CAACK,OAAT,CAAiB,GAAjB,MAA0B,CAA1B,GAA8BL,QAA9B,GAAyC,MAAMA,QADnE;AAAA;AAAA,mBAEtBM,iBAAGC,SAAH,CAAaC,cAAKC,OAAL,CAAaR,YAAb,CAAb,CAFsB;;AAAA;AAAA;AAAA,mBAGtB,IAAIS,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACrC,kBAAMC,UAAU,GAAGP,iBAAGQ,iBAAH,CAAqBb,YAArB,CAAnB;;AACAF,cAAAA,MAAM,CAACgB,IAAP,CAAYF,UAAZ;AACAd,cAAAA,MAAM,CAACiB,EAAP,CAAU,OAAV,EAAmB,UAACC,KAAD,EAAgB;AACjCL,gBAAAA,MAAM,CAACK,KAAD,CAAN;AACD,eAFD;AAGAJ,cAAAA,UAAU,CAACG,EAAX,CAAc,QAAd,EAAwB,YAAM;AAC5BL,gBAAAA,OAAO;AACR,eAFD;AAGD,aATK,CAHsB;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAH;;AAAA,kBAAdb,cAAc;AAAA;AAAA;AAAA,GAApB","sourcesContent":["import fs from 'fs-extra';\nimport path from 'path';\nimport { config } from '@app/config';\n\nexport const saveFileStream = async (stream: NodeJS.ReadableStream, filePath: string) => {\n  const saveLocation = `${config.storage.folder}${filePath.indexOf('/') === 0 ? filePath : '/' + filePath}`;\n  await fs.ensureDir(path.dirname(saveLocation));\n  await new Promise((resolve, reject) => {\n    const fileStream = fs.createWriteStream(saveLocation);\n    stream.pipe(fileStream);\n    stream.on('error', (error: any) => {\n      reject(error);\n    });\n    fileStream.on('finish', () => {\n      resolve();\n    });\n  });\n};\n"],"file":"local.storage.js"}