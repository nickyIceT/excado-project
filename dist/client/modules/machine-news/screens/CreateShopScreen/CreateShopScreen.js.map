{"version":3,"sources":["../../../../../../src/client/modules/machine-news/screens/CreateShopScreen/CreateShopScreen.tsx"],"names":["TabPane","CreateShopScreen","currentStep","selectedPackage","undefined","selectedPaymentMethod","shopInfo","introImageList","logoImageList","loading","createShop","setState","state","payload","length","introImageFormData","FormData","forEach","item","append","file","fetch","config","url","api","method","body","then","res","json","introImageResult","logoImageFormData","logoImageResult","firebase","auth","currentUser","getIdToken","idToken","serviceProxy","owner","props","profileState","authUser","id","expiryDate","Date","getTime","value","introImages","logoImage","result","_id","profileReducers","updateProfileInfo","shopDomain","domain","error","JSON","parse","response","message","storePackages","filter","package","paymentMethods","paymentMethod","base64Url","index","map","indexOf","newFileList","slice","splice","updateFilters","topBrands","searchKeyword","String","nextStep","t","selectPackageChange","backStep","handleShopInfoChange","changeLogoImage","addIntroImage","removeIntroImage","paymentMethodChange","React","Component"],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport { Tabs, message } from 'antd';\nimport {\n  ProfileState,\n  ProfileEffects,\n  ProfileReducers,\n  SelectOption,\n} from '@client/store';\nimport CommonLayout from '@client/layouts/Page/CommonLayout';\nimport CreateShopStep1 from './components/CreateShopStep1';\nimport CreateShopStep2 from './components/CreateShopStep2';\nimport CreateShopStep3 from './components/CreateShopStep3';\nimport CreateShopStep4 from './components/CreateShopStep4';\nimport CreateShopStep5 from './components/CreateShopStep5';\nimport CreateShopTitle from './components/CreateShopTitle';\nimport { Brand, Shop } from '../../../../services/service-proxies';\nimport { getServiceProxy } from '../../../../services';\nimport firebase from 'firebase/app';\nimport 'firebase/auth';\nimport { initializeFirebaseApp, getBase64Image, storePackages, paymentMethods } from '../../../../core';\nimport './CreateShopScreen.less';\nimport { UploadFile } from 'antd/lib/upload/interface';\nimport { config } from '@client/config';\nimport { withNamespaces } from '@client/i18n';\nconst TabPane = Tabs.TabPane;\n\ninterface Props {\n  topBrands: Brand[];\n  searchKeyword: string;\n  profileState: ProfileState;\n  profileReducers: ProfileReducers & ProfileEffects;\n  updateFilters: (payload: { [key: string]: string | number }) => void;\n  t: (key: string) => string;\n}\ninterface State {\n  currentStep: number;\n  selectedPackage?: { label: string; value: number; price: number };\n  selectedPaymentMethod?: SelectOption;\n  shopInfo?: Shop;\n  introImageList: {\n    file: UploadFile;\n    base64Url: string;\n  }[];\n  logoImageList: {\n    file: UploadFile;\n    base64Url: string;\n  }[];\n  loading: {\n    createShop: boolean;\n  };\n}\n\nclass CreateShopScreen extends React.Component<Props, State> {\n  state: State = {\n    currentStep: 1,\n    selectedPackage: undefined,\n    selectedPaymentMethod: undefined,\n    shopInfo: undefined,\n    introImageList: [],\n    logoImageList: [],\n    loading: {\n      createShop: false,\n    },\n  };\n\n  nextStep = () => {\n    this.setState({\n      currentStep: this.state.currentStep + 1,\n    });\n  }\n\n  backStep = () => {\n    this.setState({\n      currentStep: this.state.currentStep - 1,\n    });\n  }\n\n  handleShopInfoChange = (payload: { [key: string]: any }) => {\n    this.setState({\n      shopInfo: {\n        ...this.state.shopInfo,\n        ...payload,\n      } as any,\n    });\n  }\n\n  createShop = async () => {\n    this.setState({\n      loading: {\n        ...this.state.loading,\n        createShop: true,\n      },\n    });\n\n    try {\n      // upload intro images\n      let introImageResult: any;\n      if (this.state.introImageList.length > 0) {\n        const introImageFormData = new FormData();\n        this.state.introImageList.forEach((item) => {\n          introImageFormData.append('introImage', item.file as any);\n        });\n\n        introImageResult = await fetch(`${config.url.api}/upload-image/shop-intro-images`, {\n          method: 'POST',\n          body: introImageFormData,\n        }).then((res) => res.json());\n      }\n\n      // upload logo image\n      let logoImageResult: any;\n      if (this.state.logoImageList.length > 0) {\n        const logoImageFormData = new FormData();\n        this.state.logoImageList.forEach((item) => {\n          logoImageFormData.append('logoImage', item.file as any);\n        });\n\n        logoImageResult = await fetch(`${config.url.api}/upload-image/shop-logo-image`, {\n          method: 'POST',\n          body: logoImageFormData,\n        }).then((res) => res.json());\n      }\n\n      // create shop\n      initializeFirebaseApp();\n      const idToken = await firebase.auth().currentUser!.getIdToken();\n      const serviceProxy = getServiceProxy(idToken);\n      const result = await serviceProxy.createShop({\n        ...this.state.shopInfo,\n        owner: this.props.profileState.authUser!.id,\n        expiryDate: new Date().getTime() + this.state.selectedPackage!.value,\n        introImages: introImageResult ? introImageResult.introImages : [],\n        logoImage: logoImageResult ? logoImageResult.logoImage : '',\n      });\n\n      this.setState({\n        shopInfo: {\n          ...this.state.shopInfo,\n          id: result._id,\n        } as any,\n        currentStep: this.state.currentStep + 1,\n        loading: {\n          ...this.state.loading,\n          createShop: false,\n        },\n      });\n      this.props.profileReducers.updateProfileInfo({ shopDomain: this.state.shopInfo!.domain });\n    } catch (error) {\n      this.setState({\n        loading: {\n          ...this.state.loading,\n          createShop: false,\n        },\n      });\n      message.error(JSON.parse(error.response).message || error.message);\n    }\n  }\n\n  selectPackageChange = (payload: { package: number }) => {\n    this.setState({\n      selectedPackage: storePackages.filter((item) => item.value === payload.package)[0],\n    });\n  }\n\n  paymentMethodChange = (payload: { paymentMethod: string }) => {\n    this.setState({\n      selectedPaymentMethod: paymentMethods.filter((item) => item.value === payload.paymentMethod)[0],\n    });\n  }\n\n  addIntroImage = (file: UploadFile) => {\n    getBase64Image(file, (base64Url: string) => {\n      this.setState({\n        introImageList: [...this.state.introImageList, { file, base64Url }],\n      });\n    });\n  }\n\n  removeIntroImage = (file: UploadFile) => {\n    const index = this.state.introImageList.map((item) => item.file).indexOf(file);\n    const newFileList = this.state.introImageList.slice();\n    newFileList.splice(index, 1);\n\n    this.setState({\n      introImageList: newFileList,\n    });\n  }\n\n  changeLogoImage = (file: UploadFile) => {\n    getBase64Image(file, (base64Url: string) => {\n      this.setState({\n        logoImageList: [{ file, base64Url }],\n      });\n    });\n  };\n\n  render() {\n    return (\n      <div className='create-shop-screen'>\n        <CommonLayout\n          updateFilters={this.props.updateFilters}\n          topBrands={this.props.topBrands}\n          searchKeyword={this.props.searchKeyword}\n          hasSideBar={true}\n          hasMenuItems={true}\n          profileState={this.props.profileState}\n          profileReducers={this.props.profileReducers}\n        >\n          <CreateShopTitle currentStep={this.state.currentStep} />\n\n          <Tabs activeKey={String(this.state.currentStep)}>\n            <TabPane tab='Step 1' key='1'>\n              <CreateShopStep1 nextStep={this.nextStep} t={this.props.t} />\n            </TabPane>\n            <TabPane tab='Step 2' key='2'>\n              <CreateShopStep2\n                t={this.props.t}\n                selectedPackage={this.state.selectedPackage}\n                selectPackageChange={this.selectPackageChange}\n                currentStep={this.state.currentStep}\n                nextStep={this.nextStep}\n                backStep={this.backStep}\n              />\n            </TabPane>\n            <TabPane tab='Step 3' key='3'>\n              <CreateShopStep3\n                nextStep={this.nextStep}\n                handleShopInfoChange={this.handleShopInfoChange}\n                introImageList={this.state.introImageList}\n                logoImageList={this.state.logoImageList}\n                changeLogoImage={this.changeLogoImage}\n                addIntroImage={this.addIntroImage}\n                removeIntroImage={this.removeIntroImage}\n              />\n            </TabPane>\n            <TabPane tab='Step 4' key='4'>\n              <CreateShopStep4\n                isCreating={this.state.loading.createShop}\n                nextStep={this.nextStep}\n                selectedPackage={this.state.selectedPackage!}\n                selectedPaymentMethod={this.state.selectedPaymentMethod}\n                paymentMethodChange={this.paymentMethodChange}\n                createShop={this.createShop}\n              />\n            </TabPane>\n            <TabPane tab='Step 5' key='5'>\n              <CreateShopStep5 t={this.props.t} />\n            </TabPane>\n          </Tabs>\n        </CommonLayout>\n      </div>\n    );\n  }\n}\n\nexport default withNamespaces('create-shop')(CreateShopScreen);\n"],"file":"CreateShopScreen.js"}