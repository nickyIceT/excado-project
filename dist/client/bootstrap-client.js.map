{"version":3,"sources":["../../src/client/bootstrap-client.ts"],"names":["bootstrapClient","server","logger","info","routes","dev","process","env","NODE_ENV","nextApp","dir","handler","getRequestHandler","req","res","route","query","render","page","prepare","get","post","setCookie","clearCookie","use","authenticate","generateRecentViewedKey","checkSubdomain","i18n"],"mappings":";;;;;;;;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;;;;;;;AAEO,IAAMA,eAAe;AAAA;AAAA;AAAA;AAAA;AAAA,4BAAG;AAAA;AAAA;AAAA;AAAA;AAAA;AAASC,YAAAA,MAAT,QAASA,MAAT;;AAC7BC,yBAAOC,IAAP;;AACA,oDAAiB;AAAEC,cAAAA,MAAM,EAANA;AAAF,aAAjB;AAEMC,YAAAA,GAJuB,GAIjBC,OAAO,CAACC,GAAR,CAAYC,QAAZ,KAAyB,YAJR;AAKvBC,YAAAA,OALuB,GAKb,oBAAK;AAAEJ,cAAAA,GAAG,EAAHA,GAAF;AAAOK,cAAAA,GAAG,EAAEL,GAAG,GAAG,cAAH,GAAoB;AAAnC,aAAL,CALa;AAMvBM,YAAAA,OANuB,GAMbP,gBAAOQ,iBAAP,CAAyBH,OAAzB,EAAkC,iBAAmC;AAAA,kBAAjCI,GAAiC,SAAjCA,GAAiC;AAAA,kBAA5BC,GAA4B,SAA5BA,GAA4B;AAAA,kBAAvBC,KAAuB,SAAvBA,KAAuB;AAAA,kBAAhBC,KAAgB,SAAhBA,KAAgB;AACnFP,cAAAA,OAAO,CAACQ,MAAR,CAAeJ,GAAf,EAAoBC,GAApB,EAAyBC,KAAK,CAACG,IAA/B,EAAqCF,KAArC;AACD,aAFe,CANa;AAAA;AAAA,mBASvBP,OAAO,CAACU,OAAR,EATuB;;AAAA;AAW7BlB,YAAAA,MAAM,CAACmB,GAAP,CAAW,UAAX,EAAuB,UAACP,GAAD,EAAMC,GAAN,EAAc;AACnC,qBAAOH,OAAO,CAACE,GAAD,EAAMC,GAAN,CAAd;AACD,aAFD;AAGAb,YAAAA,MAAM,CAACmB,GAAP,CAAW,WAAX,EAAwB,UAACP,GAAD,EAAMC,GAAN,EAAc;AACpC,qBAAOH,OAAO,CAACE,GAAD,EAAMC,GAAN,CAAd;AACD,aAFD,EAd6B,CAiB7B;;AACAb,YAAAA,MAAM,CAACoB,IAAP,CAAY,aAAZ,EAA2BC,gBAA3B,EAlB6B,CAmB7B;;AACArB,YAAAA,MAAM,CAACmB,GAAP,CAAW,cAAX,EAA2BG,kBAA3B,EApB6B,CAqB7B;;AACAtB,YAAAA,MAAM,CAACuB,GAAP,CAAWC,0BAAX,EAtB6B,CAuB7B;;AACAxB,YAAAA,MAAM,CAACuB,GAAP,CAAWE,8BAAX,EAxB6B,CAyB7B;;AACAzB,YAAAA,MAAM,CAACuB,GAAP,CAAWG,qBAAX;AACA1B,YAAAA,MAAM,CAACuB,GAAP,CAAW,yBAAsBI,UAAtB,CAAX;AACA3B,YAAAA,MAAM,CAACuB,GAAP,CAAWb,OAAX;;AA5B6B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAH;;AAAA,kBAAfX,eAAe;AAAA;AAAA;AAAA,GAArB","sourcesContent":["import { Application } from '@feathersjs/express';\nimport next from 'next';\nimport routes from './routes';\nimport { bootstrapModules } from '../client/bootstrap-modules';\nimport { logger } from '../server/core';\nimport { setCookie, clearCookie, generateRecentViewedKey, checkSubdomain } from './core';\nimport nextI18NextMiddleware from 'next-i18next/middleware';\nimport { i18n } from './i18n';\nimport { authenticate } from './core/authenticate';\n\nexport const bootstrapClient = async ({ server }: { server: Application<any> }) => {\n  logger.info(`[Client] Bootstrapping...`);\n  bootstrapModules({ routes });\n\n  const dev = process.env.NODE_ENV !== 'production';\n  const nextApp = next({ dev, dir: dev ? './src/client' : './dist/client' });\n  const handler = routes.getRequestHandler(nextApp, ({req, res, route, query}: any) => {\n    nextApp.render(req, res, route.page, query);\n  });\n  await nextApp.prepare();\n\n  server.get('/_next/*', (req, res) => {\n    return handler(req, res);\n  });\n  server.get('/static/*', (req, res) => {\n    return handler(req, res);\n  });\n  // login success => set cookie on server\n  server.post('/auth/login', setCookie);\n  // logout => remove cookie\n  server.get('/auth/logout', clearCookie);\n  // authenticate\n  server.use(authenticate);\n  // recent viewed product\n  server.use(generateRecentViewedKey);\n  // check sub domain of shop\n  server.use(checkSubdomain);\n  server.use(nextI18NextMiddleware(i18n));\n  server.use(handler);\n};\n"],"file":"bootstrap-client.js"}