{"version":3,"sources":["../../../src/client/core/checkSubdomain.ts"],"names":["checkSubdomain","req","res","next","subdomains","length","shopDomain","config","url","main","indexOf","authUserId","authUser","id","serviceProxies","findShopByDomain","shopResult","shopInfo","allowPaths","redirect"],"mappings":";;;;;;;;;AAAA;;AACA;;;;;;;;AAEO,IAAMA,cAAc;AAAA;AAAA;AAAA;AAAA;AAAA,4BAAG,iBAAOC,GAAP,EAAiBC,GAAjB,EAA2BC,IAA3B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACxBF,GAAG,CAACG,UAAJ,IAAkBH,GAAG,CAACG,UAAJ,CAAeC,MAAf,GAAwB,CADlB;AAAA;AAAA;AAAA;;AAEtBC,YAAAA,UAFsB,GAET,EAFS;;AAG1B,gBAAIC,eAAOC,GAAP,CAAWC,IAAX,4BAA2CR,GAAG,CAACG,UAAJ,CAAe,CAAf,WAA/C,EAA4E;AAC1EE,cAAAA,UAAU,GAAGL,GAAG,CAACG,UAAJ,CAAe,CAAf,CAAb;AACD,aAFD,MAEO,IAAIG,eAAOC,GAAP,CAAWC,IAAX,iCAAgDR,GAAG,CAACG,UAAJ,CAAe,CAAf,WAApD,EAAiF;AACtFE,cAAAA,UAAU,GAAGL,GAAG,CAACG,UAAJ,CAAe,CAAf,CAAb;AACD,aAFM,MAEA,IAAIG,eAAOC,GAAP,CAAWC,IAAX,CAAgBC,OAAhB,kBAAyC,CAAC,CAA1C,IAA+CT,GAAG,CAACG,UAAJ,CAAe,CAAf,WAAnD,EAAgF;AACrFE,cAAAA,UAAU,GAAGL,GAAG,CAACG,UAAJ,CAAe,CAAf,CAAb;AACD,aAFM,MAEA,IAAIH,GAAG,CAACG,UAAJ,CAAe,CAAf,WAAJ,EAAiC;AACtCE,cAAAA,UAAU,GAAGL,GAAG,CAACG,UAAJ,CAAe,CAAf,CAAb;AACD;;AAXyB,iBAatBE,UAbsB;AAAA;AAAA;AAAA;;AAclBK,YAAAA,UAdkB,GAcLV,GAAG,CAACW,QAAJ,GAAeX,GAAG,CAACW,QAAJ,CAAaC,EAA5B,GAAiC,EAd5B;AAelBC,YAAAA,cAfkB,GAeD,gCAfC;AAAA;AAAA,mBAgBCA,cAAc,CAACC,gBAAf,CAAgCT,UAAhC,EAA4CK,UAA5C,CAhBD;;AAAA;AAgBlBK,YAAAA,UAhBkB;;AAkBxB,gBAAIA,UAAJ,EAAgB;AACdf,cAAAA,GAAG,CAACgB,QAAJ,GAAeD,UAAf;AACME,cAAAA,UAFQ,GAEK,CAAC,qBAAD,EAAwB,oBAAxB,CAFL;;AAGd,kBAAIA,UAAU,CAACR,OAAX,CAAmBT,GAAG,CAACO,GAAvB,IAA8B,CAAC,CAA/B,IAAoCP,GAAG,CAACO,GAAJ,CAAQE,OAAR,CAAgB,oBAAhB,IAAwC,CAAC,CAAjF,EAAoF;AAClFP,gBAAAA,IAAI;AACL,eAFD,MAEO;AACLD,gBAAAA,GAAG,CAACiB,QAAJ,CAAa,qBAAb;AACD;AACF,aARD,MAQO;AACL;AACAjB,cAAAA,GAAG,CAACiB,QAAJ,WAAgBZ,eAAOC,GAAP,CAAWC,IAA3B;AACD;;AA7BuB;AAAA;;AAAA;AA+BxBN,YAAAA,IAAI;;AA/BoB;AAAA;AAAA;;AAAA;AAkC1BA,YAAAA,IAAI;;AAlCsB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAH;;AAAA,kBAAdH,cAAc;AAAA;AAAA;AAAA,GAApB","sourcesContent":["import { getServiceProxy } from '@client/services';\nimport { config } from '@client/config';\n\nexport const checkSubdomain = async (req: any, res: any, next: any) => {\n  if (req.subdomains && req.subdomains.length > 0) {\n    let shopDomain = '';\n    if (config.url.main === `https://timmay.vn` && req.subdomains[0] !== `www`) {\n      shopDomain = req.subdomains[0];\n    } else if (config.url.main === `https://test.timmay.vn` && req.subdomains[1] !== `www`) {\n      shopDomain = req.subdomains[1];\n    } else if (config.url.main.indexOf(`techkids.io`) > -1 && req.subdomains[1] !== `www`) {\n      shopDomain = req.subdomains[1];\n    } else if (req.subdomains[0] !== `www`) {\n      shopDomain = req.subdomains[0];\n    }\n\n    if (shopDomain) {\n      const authUserId = req.authUser ? req.authUser.id : '';\n      const serviceProxies = getServiceProxy();\n      const shopResult = await serviceProxies.findShopByDomain(shopDomain, authUserId);\n\n      if (shopResult) {\n        req.shopInfo = shopResult;\n        const allowPaths = ['/thong-tin-cua-hang', '/bai-dang-cua-hang'];\n        if (allowPaths.indexOf(req.url) > -1 || req.url.indexOf('/bai-dang-cua-hang') > -1) {\n          next();\n        } else {\n          res.redirect('/thong-tin-cua-hang');\n        }\n      } else {\n        // custom 404 page\n        res.redirect(`${config.url.main}/not-found`);\n      }\n    } else {\n      next();\n    }\n  } else {\n    next();\n  }\n};\n"],"file":"checkSubdomain.js"}