{"version":3,"sources":["../../../src/client/core/authenticate.ts"],"names":["authenticate","req","res","next","url","indexOf","bearerToken","cookies","token","headers","authorization","replace","admin","auth","verifyIdToken","tokenInfo","authUser","id","uid","fullName","name","avatarUrl","province","roles","permissions","redirect"],"mappings":";;;;;;;;;AAAA;;;;;;;;AAEO,IAAMA,YAAY;AAAA;AAAA;AAAA;AAAA;AAAA,4BAAG,iBAAOC,GAAP,EAAiBC,GAAjB,EAA2BC,IAA3B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACtBF,GAAG,CAACG,GAAJ,CAAQC,OAAR,CAAgB,gBAAhB,MAAsC,CAAC,CADjB;AAAA;AAAA;AAAA;;AAElBC,YAAAA,WAFkB,GAEJL,GAAG,CAACM,OAAJ,CAAYC,KAAZ,IAAqBP,GAAG,CAACQ,OAAJ,CAAYC,aAF7B;;AAAA,iBAGpBJ,WAHoB;AAAA;AAAA;AAAA;;AAAA;AAKdE,YAAAA,KALc,GAKNF,WAAW,CAACK,OAAZ,CAAoB,SAApB,EAA+B,EAA/B,CALM;AAAA;AAAA,mBAMIC,uBAAMC,IAAN,GAAaC,aAAb,CAA2BN,KAA3B,CANJ;;AAAA;AAMdO,YAAAA,SANc;AAQpBd,YAAAA,GAAG,CAACe,QAAJ,GAAe;AACbC,cAAAA,EAAE,EAAEF,SAAS,CAAEG,GADF;AAEbC,cAAAA,QAAQ,EAAEJ,SAAS,CAACK,IAFP;AAGbC,cAAAA,SAAS,EAAEN,SAAS,CAACM,SAHR;AAIbC,cAAAA,QAAQ,EAAEP,SAAS,CAACO,QAJP;AAKbC,cAAAA,KAAK,EAAER,SAAS,CAACQ,KALJ;AAMbC,cAAAA,WAAW,EAAET,SAAS,CAACS;AANV,aAAf;AASArB,YAAAA,IAAI;AAjBgB;AAAA;;AAAA;AAAA;AAAA;AAmBpBD,YAAAA,GAAG,CAACuB,QAAJ,CAAa,gBAAb;;AAnBoB;AAAA;AAAA;;AAAA;AAsBtBtB,YAAAA,IAAI;;AAtBkB;AAAA;AAAA;;AAAA;AAyBxBA,YAAAA,IAAI;;AAzBoB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAH;;AAAA,kBAAZH,YAAY;AAAA;AAAA;AAAA,GAAlB","sourcesContent":["import admin from 'firebase-admin';\n\nexport const authenticate = async (req: any, res: any, next: any) => {\n  if (req.url.indexOf('/refresh-token') === -1) {\n    const bearerToken = req.cookies.token || req.headers.authorization;\n    if (bearerToken) {\n      try {\n        const token = bearerToken.replace('Bearer ', '');\n        const tokenInfo = await admin.auth().verifyIdToken(token);\n\n        req.authUser = {\n          id: tokenInfo!.uid,\n          fullName: tokenInfo.name,\n          avatarUrl: tokenInfo.avatarUrl,\n          province: tokenInfo.province,\n          roles: tokenInfo.roles,\n          permissions: tokenInfo.permissions,\n        };\n\n        next();\n      } catch (error) {\n        res.redirect('/refresh-token');\n      }\n    } else {\n      next();\n    }\n  } else {\n    next();\n  }\n};\n"],"file":"authenticate.js"}